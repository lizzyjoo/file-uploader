<div class="sidebar">
  <div class="sidebar-container">
    <button id="addFileBtn"><span><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g clip-path="url(#clip0_429_11181)"> <path d="M7 21C5.89543 21 5 20.1046 5 19V3H14L19 8V19C19 20.1046 18.1046 21 17 21H7Z" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 13V17" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M10 15H14" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M13 3V9H19" stroke="#000000" stroke-width="2.5" stroke-linejoin="round"></path> </g> <defs> <clipPath id="clip0_429_11181"> <rect width="24" height="24" fill="white"></rect> </clipPath> </defs> </g></svg></span>Add File</button>
    <!-- Add Folder Button -->
    <button id="addFolderBtn"><span><svg fill="#000000" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>plus-folder</title> <path d="M0 26.016q0 2.496 1.76 4.224t4.256 1.76h16.992q2.432 0 4.512-1.216t3.296-3.296 1.184-4.48v-12.992q0-2.496-1.76-4.256t-4.224-1.76h-6.368q-0.64-1.76-2.176-2.88t-3.456-1.12h-8q-2.496 0-4.256 1.76t-1.76 4.256v20zM4 26.016v-20q0-0.832 0.576-1.408t1.44-0.608h8q0.8 0 1.408 0.608t0.576 1.408v1.984h10.016q0.8 0 1.408 0.576t0.576 1.408v5.536q-2.272-1.536-4.992-1.536-1.824 0-3.488 0.736t-2.88 1.92-1.92 2.848-0.704 3.52q0 2.72 1.504 4.992h-9.504q-0.832 0-1.44-0.576t-0.576-1.408zM18.016 23.008q0-2.080 1.44-3.552t3.552-1.472 3.52 1.472 1.472 3.552q0 2.080-1.504 3.52t-3.488 1.472q-2.080 0-3.552-1.472t-1.44-3.52zM20 24h2.016v1.984h1.984v-1.984h2.016v-2.016h-2.016v-1.984h-1.984v1.984h-2.016v2.016z"></path> </g></svg></span>Add Folder</button>
  </div>
</div>

<div id="folder-modal" class="modal hidden">
  <div class="modal-content">
    <span id="closeFolderModalBtn" class="close">&times;</span>
    <!-- Add target="_self" to force traditional submission -->
    <form
      action="/add-folder"
      method="POST"
      target="_self"
      onsubmit="console.log('Form submitting normally');"
    >
      <label for="folder-name">Folder Name:</label>
      <input type="text" id="folder-name" name="folderName" required />
      <button type="submit">Create Folder</button>
    </form>
  </div>
</div>

<!-- File Modal -->
<div id="file-modal" class="modal hidden">
  <div class="modal-content">
    <span id="closeFileModalBtn" class="close">&times;</span>
    <form action="/upload" method="POST" enctype="multipart/form-data">
      <label for="user-file">Choose file:</label>
      <input type="file" name="user-file" required />
      
      <!-- Hidden field for folder ID if uploading within a folder -->
      <% if (typeof currentFolder !== 'undefined' && currentFolder) { %>
        <input type="hidden" name="folderId" value="<%= currentFolder.id %>" />
        <p class="upload-location">Uploading to: <%= currentFolder.name %></p>
      <% } %>
      
      <button type="submit">Upload</button>
    </form>
  </div>
</div>
<script>
  const openFileModalBtn = document.getElementById("addFileBtn");
  const openFolderModalBtn = document.getElementById("addFolderBtn");

  const folderModal = document.getElementById("folder-modal");
  const fileModal = document.getElementById("file-modal");

  const closeFolderBtn = document.getElementById("closeFolderModalBtn");
  const closeFileBtn = document.getElementById("closeFileModalBtn");

  // Show modals
  openFileModalBtn.addEventListener("click", () => {
    fileModal.style.display = "block";
  });

  openFolderModalBtn.addEventListener("click", () => {
    folderModal.style.display = "block";
  });

  // Close modals
  closeFolderBtn.addEventListener("click", () => {
    folderModal.style.display = "none";
  });

  closeFileBtn.addEventListener("click", () => {
    fileModal.style.display = "none";
  });

  // Close if clicking outside the modal
  window.addEventListener("click", (event) => {
    if (event.target === folderModal) {
      folderModal.style.display = "none";
    }
    if (event.target === fileModal) {
      fileModal.style.display = "none";
    }
  });

  // Debug form submission

  const folderForm = document.querySelector("#folder-modal form");
  if (folderForm) {
    console.log("Form found");

    // Check for existing listeners (this is a hack but works for debugging)
    const originalAddEventListener = folderForm.addEventListener;
    folderForm.addEventListener = function (type, listener, options) {
      console.warn(`⚠️ Event listener added to form: ${type}`);
      console.trace();
      return originalAddEventListener.call(this, type, listener, options);
    };

    // Add our own submit listener to see what happens
    folderForm.addEventListener(
      "submit",
      function (e) {
        console.log("Form is submitting!");
        console.log("Is default prevented?", e.defaultPrevented);
        // Don't prevent default - let it submit normally
      },
      true
    ); // Use capture phase to run first
  }

  // Check for global form interceptors
  window.addEventListener(
    "submit",
    function (e) {
      console.log("Global submit event captured for:", e.target);
      console.log("Is default prevented?", e.defaultPrevented);
    },
    true
  );
</script>
